<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Optimise Experimental Design Layout Using Simulated Annealing — speed • speed</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimise Experimental Design Layout Using Simulated Annealing — speed"><meta name="description" content="Optimises the spatial layout of experimental designs using simulated
annealing to minimise treatment adjacency and maintain treatment balance
across spatial factors. Works with regular or irregular spatial designs."><meta property="og:description" content="Optimises the spatial layout of experimental designs using simulated
annealing to minimise treatment adjacency and maintain treatment balance
across spatial factors. Works with regular or irregular spatial designs."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">speed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/speed.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/complex_designs.html">Complex Agricultural Experimental Designs with speed</a></li>
    <li><a class="dropdown-item" href="../articles/custom_objective_functions.html">Custom Objective Functions and Advanced Options for Optimisation in speed</a></li>
    <li><a class="dropdown-item" href="../articles/met.html">Multi-Environment Trials with speed</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/biometryhub/speed/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Optimise Experimental Design Layout Using Simulated Annealing</h1>
      <small class="dont-index">Source: <a href="https://github.com/biometryhub/speed/blob/main/R/speed.R" class="external-link"><code>R/speed.R</code></a></small>
      <div class="d-none name"><code>speed.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Optimises the spatial layout of experimental designs using simulated
annealing to minimise treatment adjacency and maintain treatment balance
across spatial factors. Works with regular or irregular spatial designs.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">speed</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">swap</span>,</span>
<span>  swap_within <span class="op">=</span> <span class="st">"1"</span>,</span>
<span>  spatial_factors <span class="op">=</span> <span class="op">~</span><span class="va">row</span> <span class="op">+</span> <span class="va">col</span>,</span>
<span>  grid_factors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dim1 <span class="op">=</span> <span class="st">"row"</span>, dim2 <span class="op">=</span> <span class="st">"col"</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  early_stop_iterations <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  obj_function <span class="op">=</span> <span class="va">objective_function</span>,</span>
<span>  swap_all <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  optimise <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  optimise_params <span class="op">=</span> <span class="fu"><a href="optim_params.html">optim_params</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame containing the experimental design with spatial
coordinates</p></dd>


<dt id="arg-swap">swap<a class="anchor" aria-label="anchor" href="#arg-swap"></a></dt>
<dd><p>A column name of the items to be swapped (e.g., <code>treatment</code>,
<code>variety</code>, <code>genotype</code>, etc). For hierarchical designs, provide a named
list where each name corresponds to a hierarchy level (e.g.,
<code>list(wp = "wholeplot_treatment", sp = "subplot_treatment")</code>).
See details for more information.</p></dd>


<dt id="arg-swap-within">swap_within<a class="anchor" aria-label="anchor" href="#arg-swap-within"></a></dt>
<dd><p>A string specifying the variable that defines a boundary
within which to swap treatments. Specify <code>"1"</code> or <code>"none"</code> for no boundary
(default: <code>"1"</code>). Other examples might be <code>"block"</code> or <code>"replicate"</code> or
even <code>"site"</code>. For hierarchical designs, provide a named list with names
matching <code>swap</code> to optimise a hierarchical design such as a split-plot.
See details for more information.</p></dd>


<dt id="arg-spatial-factors">spatial_factors<a class="anchor" aria-label="anchor" href="#arg-spatial-factors"></a></dt>
<dd><p>A one-sided formula specifying spatial factors to
consider for balance (default: <code>~row + col</code>).</p></dd>


<dt id="arg-grid-factors">grid_factors<a class="anchor" aria-label="anchor" href="#arg-grid-factors"></a></dt>
<dd><p>A named list specifying grid factors to construct a
matrix for calculating adjacency score, <code>dim1</code> for row and <code>dim2</code> for
column. (default: <code>list(dim1 = "row", dim2 = "col")</code>).</p></dd>


<dt id="arg-iterations">iterations<a class="anchor" aria-label="anchor" href="#arg-iterations"></a></dt>
<dd><p>Maximum number of iterations for the simulated annealing
algorithm (default: 10000). For hierarchical designs, can be a named list
with names matching <code>swap</code>.</p></dd>


<dt id="arg-early-stop-iterations">early_stop_iterations<a class="anchor" aria-label="anchor" href="#arg-early-stop-iterations"></a></dt>
<dd><p>Number of iterations without improvement before
early stopping (default: 2000). For hierarchical designs, can be a named
list with names matching <code>swap</code>.</p></dd>


<dt id="arg-obj-function">obj_function<a class="anchor" aria-label="anchor" href="#arg-obj-function"></a></dt>
<dd><p>Objective function used to calculate score (lower is
better) (default: <code><a href="objective_functions.html">objective_function()</a></code>). For hierarchical designs, can
be a named list with names matching <code>swap</code>.</p></dd>


<dt id="arg-swap-all">swap_all<a class="anchor" aria-label="anchor" href="#arg-swap-all"></a></dt>
<dd><p>Logical; Whether to swap all matching items or a single item
at a time (default: FALSE)</p></dd>


<dt id="arg-optimise">optimise<a class="anchor" aria-label="anchor" href="#arg-optimise"></a></dt>
<dd><p>A list of named arguments describing optimising parameters;
see more in example.</p></dd>


<dt id="arg-optimise-params">optimise_params<a class="anchor" aria-label="anchor" href="#arg-optimise-params"></a></dt>
<dd><p>Parameters used to control the behaviour of
simulated annealing algorithm. See <code><a href="optim_params.html">optim_params()</a></code> for more details.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Logical; if TRUE, suppresses progress messages (default: FALSE)</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>A numeric value for random seed. If provided, it ensures
reproducibility of results (default: <code>NULL</code>).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments passed through to objective functions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing:</p><ul><li><p><strong>design_df</strong> - Data frame of optimised design</p></li>
<li><p><strong>score</strong> - Final optimisation score</p></li>
<li><p><strong>scores</strong> - Vector of scores across iterations (for simple designs) or
named list of score vectors (for hierarchical designs)</p></li>
<li><p><strong>temperatures</strong> - Vector of temperatures across iterations</p></li>
<li><p><strong>iterations_run</strong> - Total number of iterations performed</p></li>
<li><p><strong>stopped_early</strong> - Logical indicating if optimisation stopped early
(for simple designs) or named logical vector (for hierarchical designs)</p></li>
<li><p><strong>treatments</strong> - Vector of unique treatments (for simple designs) or
named list of treatment vectors (for hierarchical designs)</p></li>
<li><p><strong>seed</strong> - Random seed used for reproducibility of the design. If not set
in the function, the seed is set to the third element of <code>.Random.seed</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function provides a very general interface for producing experimental
designs of different types. For hierarchical designs such as split-plots,
strip plots, split-split plots and similar nested structures, the key
arguments (<code>swap</code>, <code>swap_within</code>, <code>iterations</code>, <code>early_stop_iterations</code> and
<code>obj_function</code>) can be provided as named lists where each name corresponds
to a level in the hierarchy (e.g., "wholeplot", "subplot"). When these
arguments are provided as named lists with matching names, the optimisation
is applied sequentially at each hierarchical level, starting with the first
level and progressing through the hierarchy. This allows for different
optimisation parameters and objective functions to be applied at different
levels of the design structure. For simple (non-hierarchical) designs, these
arguments can be provided as single values. For more examples and detailed
usage, see the package vignettes.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create a simple design with 3 replicates of 4 treatments in a 4x3 layout</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, times <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Optimise the design</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">speed</span><span class="op">(</span><span class="va">df</span>, swap <span class="op">=</span> <span class="st">"treatment"</span>, seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> row and col are used as row and column, respectively.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimising level: single treatment within whole design </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Level: single treatment within whole design Iteration: 1000 Score: 1 Best: 1 Since Improvement: 275 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Level: single treatment within whole design Iteration: 2000 Score: 1 Best: 1 Since Improvement: 1275 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Early stopping at iteration 2725 for level single treatment within whole design </span>
<span class="r-in"><span><span class="fu"><a href="autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="speed-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Hierarchical split-plot design</span></span></span>
<span class="r-in"><span><span class="va">df_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, times <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, each <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  wholeplot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  wholeplot_treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  subplot_treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">12</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">speed</span><span class="op">(</span><span class="va">df_split</span>,</span></span>
<span class="r-in"><span>                swap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wp <span class="op">=</span> <span class="st">"wholeplot_treatment"</span>,</span></span>
<span class="r-in"><span>                            sp <span class="op">=</span> <span class="st">"subplot_treatment"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                swap_within <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wp <span class="op">=</span> <span class="st">"block"</span>, sp <span class="op">=</span> <span class="st">"wholeplot"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                swap_all <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> row and col are used as row and column, respectively.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimising level: wp </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Level: wp Iteration: 1000 Score: 100 Best: 100 Since Improvement: 1000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Level: wp Iteration: 2000 Score: 100 Best: 100 Since Improvement: 2000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Early stopping at iteration 2000 for level wp </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimising level: sp </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Early stopping at iteration 570 for level sp </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot wholeplot allocations within blocks</span></span></span>
<span class="r-in"><span><span class="fu"><a href="autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">result</span>, treatments <span class="op">=</span> <span class="st">"wholeplot_treatment"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="speed-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Plot subplot allocations within wholeplots</span></span></span>
<span class="r-in"><span><span class="fu"><a href="autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">result</span>, treatments <span class="op">=</span> <span class="st">"subplot_treatment"</span>, block <span class="op">=</span> <span class="st">"wholeplot"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="speed-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using optimise parameter</span></span></span>
<span class="r-in"><span><span class="co"># Multi-Environment Trial (MET) design</span></span></span>
<span class="r-in"><span><span class="co"># With 7 replicates of 100 lines in this design, each line will appear</span></span></span>
<span class="r-in"><span><span class="co"># twice at two different sites and once at the rest of the sites.</span></span></span>
<span class="r-in"><span><span class="va">lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="initialise_design_df.html">initialise_design_df</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">28</span>, <span class="fl">5</span>, <span class="fl">14</span>, <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df_initial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df_site</span>, <span class="va">df_site</span>, <span class="va">df_site</span>, <span class="va">df_site</span>, <span class="va">df_site</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df_initial</span><span class="op">$</span><span class="va">lines</span> <span class="op">&lt;-</span> <span class="va">lines</span></span></span>
<span class="r-in"><span><span class="va">df_initial</span><span class="op">$</span><span class="va">site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">140</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">df_initial</span><span class="op">$</span><span class="va">site_row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">df_initial</span><span class="op">$</span><span class="va">site</span>, <span class="va">df_initial</span><span class="op">$</span><span class="va">row</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df_initial</span><span class="op">$</span><span class="va">site_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">df_initial</span><span class="op">$</span><span class="va">site</span>, <span class="va">df_initial</span><span class="op">$</span><span class="va">col</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df_initial</span><span class="op">$</span><span class="va">site_block</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">df_initial</span><span class="op">$</span><span class="va">site</span>, <span class="va">df_initial</span><span class="op">$</span><span class="va">block</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">optimise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  connectivity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>spatial_factors <span class="op">=</span> <span class="op">~</span><span class="va">site</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  balance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>swap_within <span class="op">=</span> <span class="st">"site"</span>, spatial_factors <span class="op">=</span> <span class="op">~</span> <span class="va">site_col</span> <span class="op">+</span> <span class="va">site_block</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">speed</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">df_initial</span>,</span></span>
<span class="r-in"><span>  swap <span class="op">=</span> <span class="st">"lines"</span>,</span></span>
<span class="r-in"><span>  optimise <span class="op">=</span> <span class="va">optimise</span>,</span></span>
<span class="r-in"><span>  optimise_params <span class="op">=</span> <span class="fu"><a href="optim_params.html">optim_params</a></span><span class="op">(</span>random_initialisation <span class="op">=</span> <span class="cn">TRUE</span>, adj_weight <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  seed <span class="op">=</span> <span class="fl">112</span>,</span></span>
<span class="r-in"><span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">design_df</span><span class="op">$</span><span class="va">lines</span>, <span class="va">result</span><span class="op">$</span><span class="va">design_df</span><span class="op">$</span><span class="va">site</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     a b c d e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 1 1 2 1 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2 1 2 1 1 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3 2 1 1 2 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4 1 1 1 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   5 1 1 1 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   6 2 1 1 1 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the MET design with facets</span></span></span>
<span class="r-in"><span><span class="fu"><a href="autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">result</span>, treatments <span class="op">=</span> <span class="st">"lines"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">site</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="speed-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sam Rogers, Julian Taylor, Russell Edson, Wasin Pipattungsakul, University of Adelaide, Grains Research and Development Corporation.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

