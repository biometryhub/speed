<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Complex Agricultural Experimental Designs with speed • speed</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="complex_designs_files/libs/quarto-html/popper.min.js"></script><script src="complex_designs_files/libs/quarto-html/tippy.umd.min.js"></script><link href="complex_designs_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="complex_designs_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Complex Agricultural Experimental Designs with speed">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">speed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/speed.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/complex_designs.html">Complex Agricultural Experimental Designs with speed</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/biometryhub/speed/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Complex Agricultural Experimental Designs with speed</h1>

      <p class="author">Sam Rogers</p>
      <p class="date">2025-10-09</p>

      <small class="dont-index">Source: <a href="https://github.com/biometryhub/speed/blob/main/vignettes/complex_designs.qmd" class="external-link"><code>vignettes/complex_designs.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="section level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette covers advanced and complex experimental designs that are used in specialised agricultural research contexts. These designs are particularly useful for plant breeding programs, large-scale variety trials, and situations where standard complete block designs are impractical due to resource constraints or the nature of the treatments.</p>
<p>Building on the foundational designs covered in the <a href="./speed.html">Common Agricultural Experimental Designs vignette</a>, these complex designs offer solutions for challenging experimental scenarios while maintaining statistical rigour through spatial optimisation with the <code>speed</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://biometryhub.github.io/speed/">speed</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span> <span class="co"># For combining plots</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="split-split-plot-designs">Split-Split Plot Designs<a class="anchor" aria-label="anchor" href="#split-split-plot-designs"></a>
</h2>
<section class="level2"><h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>Split-split plot designs extend the hierarchical structure of <a href="./speed.html#split-plot-design">split-plot designs</a> to accommodate three factors with different levels of experimental difficulty or practical constraints. This creates a three-level hierarchy of experimental units.</p>
</section><section class="level2"><h3 id="hierarchical-structure">Hierarchical Structure<a class="anchor" aria-label="anchor" href="#hierarchical-structure"></a>
</h3>
<section class="level3"><h4 id="whole-plots-main-plots">Whole Plots (Main Plots)<a class="anchor" aria-label="anchor" href="#whole-plots-main-plots"></a>
</h4>
<ul>
<li><strong>Largest experimental units</strong></li>
<li>
<strong>Factor A</strong> applied to whole plots</li>
<li><strong>Most difficult factor to randomise</strong></li>
<li>
<strong>Example</strong>: Tillage systems, irrigation methods</li>
</ul></section><section class="level3"><h4 id="sub-plots-split-plots">Sub-Plots (Split Plots)<a class="anchor" aria-label="anchor" href="#sub-plots-split-plots"></a>
</h4>
<ul>
<li><strong>Intermediate-sized units within whole plots</strong></li>
<li>
<strong>Factor B</strong> applied to sub-plots</li>
<li><strong>Moderate randomisation difficulty</strong></li>
<li>
<strong>Example</strong>: Fertilizer treatments, planting dates</li>
</ul></section><section class="level3"><h4 id="sub-sub-plots-split-split-plots">Sub-Sub-Plots (Split-Split Plots)<a class="anchor" aria-label="anchor" href="#sub-sub-plots-split-split-plots"></a>
</h4>
<ul>
<li><strong>Smallest experimental units</strong></li>
<li>
<strong>Factor C</strong> applied to sub-sub-plots</li>
<li><strong>Easiest factor to randomise</strong></li>
<li>
<strong>Example</strong>: Varieties, pesticide treatments</li>
</ul></section></section><section class="level2"><h3 id="error-structure">Error Structure<a class="anchor" aria-label="anchor" href="#error-structure"></a>
</h3>
<p>Complex error structure with multiple error terms:</p>
<ul>
<li>
<strong>Whole plot error</strong> for Factor A effects</li>
<li>
<strong>Sub-plot error</strong> for Factor B and A×B effects<br>
</li>
<li>
<strong>Sub-sub-plot error</strong> for Factor C and higher-order interactions</li>
</ul></section><section class="level2"><h3 id="when-to-use-split-split-plot-designs">When to Use Split-Split Plot Designs<a class="anchor" aria-label="anchor" href="#when-to-use-split-split-plot-designs"></a>
</h3>
<ul>
<li><strong>Three factors with different application constraints</strong></li>
<li>
<strong>Hierarchical treatment structure</strong> matches practical needs</li>
<li>
<strong>Sequential application</strong> of treatments over time</li>
<li>
<strong>Resource or equipment limitations</strong> for some factors</li>
</ul></section><section class="level2"><h3 id="examples-of-applications">Examples of Applications<a class="anchor" aria-label="anchor" href="#examples-of-applications"></a>
</h3>
<section class="level3"><h4 id="agricultural-examples">Agricultural Examples<a class="anchor" aria-label="anchor" href="#agricultural-examples"></a>
</h4>
<ul>
<li>
<strong>Tillage × Fertilizer × Variety</strong> experiments</li>
<li>
<strong>Irrigation × Planting Date × Cultivar</strong> studies</li>
<li>
<strong>Cover Crop × Nitrogen × Hybrid</strong> trials</li>
</ul></section><section class="level3"><h4 id="industrial-examples">Industrial Examples<a class="anchor" aria-label="anchor" href="#industrial-examples"></a>
</h4>
<ul>
<li>
<strong>Temperature × Pressure × Catalyst</strong> process studies</li>
<li>
<strong>Machine × Operator × Material</strong> quality experiments</li>
</ul></section></section><section class="level2"><h3 id="example-split-split-plot-design-for-agricultural-systems-research">Example: Split-Split Plot Design for Agricultural Systems Research<a class="anchor" aria-label="anchor" href="#example-split-split-plot-design-for-agricultural-systems-research"></a>
</h3>
<p>Consider a complex agricultural trial examining Tillage System × Nitrogen Rate × Variety interactions with three hierarchical levels.</p>
</section><section class="level2"><h3 id="setting-up-split-split-plot-designs-with-speed">Setting Up Split-Split Plot Designs with speed<a class="anchor" aria-label="anchor" href="#setting-up-split-split-plot-designs-with-speed"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">split_split_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span>, each <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, times <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, each <span class="op">=</span> <span class="fl">36</span><span class="op">)</span>,</span>
<span>  <span class="co"># Fixed wholeplot assignment: 3 wholeplots per block, each 4×3</span></span>
<span>  wholeplot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">3</span> <span class="op">*</span> <span class="fl">3</span>, each <span class="op">=</span> <span class="fl">36</span><span class="op">)</span>,</span>
<span>  wholeplot_treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>  subplot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">48</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  subplot_treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  subsubplot_treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>, <span class="fl">48</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ssplot1" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-ssplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="complex_designs_files/figure-html/fig-ssplot1-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ssplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 1: Initial layout of the split-split-plot design showing systematic treatment distribution.
</figcaption></figure>
</div>
</div>
</div>
<p>This shows the initial split-split plot design with three-level hierarchical structure.</p>
<section class="level3"><h4 id="performing-the-optimisation">Performing the Optimisation<a class="anchor" aria-label="anchor" href="#performing-the-optimisation"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result_ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speed.html">speed</a></span><span class="op">(</span><span class="va">split_split_df</span>,</span>
<span>                   swap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wp <span class="op">=</span> <span class="st">"wholeplot_treatment"</span>,</span>
<span>                               sp <span class="op">=</span> <span class="st">"subplot_treatment"</span>,</span>
<span>                               ssp <span class="op">=</span> <span class="st">"subsubplot_treatment"</span><span class="op">)</span>,</span>
<span>                   swap_within <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wp <span class="op">=</span> <span class="st">"block"</span>,</span>
<span>                                      sp <span class="op">=</span> <span class="st">"wholeplot"</span>,</span>
<span>                                      ssp <span class="op">=</span> <span class="st">"subplot"</span><span class="op">)</span>,</span>
<span>                   iterations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wp <span class="op">=</span> <span class="fl">2000</span>, </span>
<span>                                     sp <span class="op">=</span> <span class="fl">5000</span>, </span>
<span>                                     ssp <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span>,</span>
<span>                   early_stop_iterations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wp <span class="op">=</span> <span class="fl">1000</span>, </span>
<span>                                                sp <span class="op">=</span> <span class="fl">3000</span>, </span>
<span>                                                ssp <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span>,</span>
<span>                   swap_all <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                   seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>row and col are used as row and column, respectively.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimising level: wp
Level: wp Iteration: 1000 Score: 252 Best: 252 Since Improvement: 972
Early stopping at iteration 1028 for level wp
Optimising level: sp
Level: sp Iteration: 1000 Score: 132 Best: 132 Since Improvement: 594
Level: sp Iteration: 2000 Score: 132 Best: 132 Since Improvement: 1594
Level: sp Iteration: 3000 Score: 132 Best: 132 Since Improvement: 2594
Early stopping at iteration 3406 for level sp
Optimising level: ssp
Level: ssp Iteration: 1000 Score: 12 Best: 12 Since Improvement: 46
Level: ssp Iteration: 2000 Score: 10 Best: 10 Since Improvement: 617
Level: ssp Iteration: 3000 Score: 9 Best: 9 Since Improvement: 346
Level: ssp Iteration: 4000 Score: 9 Best: 9 Since Improvement: 1346
Level: ssp Iteration: 5000 Score: 9 Best: 9 Since Improvement: 2346
Level: ssp Iteration: 6000 Score: 9 Best: 9 Since Improvement: 3346
Level: ssp Iteration: 7000 Score: 9 Best: 9 Since Improvement: 4346
Early stopping at iteration 7654 for level ssp </code></pre>
</div>
</div>
</section><section class="level3"><h4 id="output-of-the-optimisation">Output of the Optimisation<a class="anchor" aria-label="anchor" href="#output-of-the-optimisation"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result_ss</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimised Experimental Design
----------------------------
Score: 393
Iterations Run: 12091
Stopped Early: TRUE TRUE TRUE
Treatments:
  wp: A, B, C
  sp: a, b, c, d
  ssp: x, y, z
Seed: 42 </code></pre>
</div>
</div>
</section><section class="level3"><h4 id="visualise-the-output">Visualise the Output<a class="anchor" aria-label="anchor" href="#visualise-the-output"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">result_ss</span>, treatments <span class="op">=</span> <span class="st">"wholeplot_treatment"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Whole plot Treatments"</span><span class="op">)</span></span>
<span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">result_ss</span>, treatments <span class="op">=</span> <span class="st">"subplot_treatment"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sub-plot Treatments"</span><span class="op">)</span></span>
<span><span class="va">res3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">result_ss</span>, treatments <span class="op">=</span> <span class="st">"subsubplot_treatment"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sub-sub-plot Treatments"</span><span class="op">)</span></span>
<span><span class="va">res1</span> <span class="op">+</span> <span class="va">res2</span> <span class="op">+</span> <span class="va">res3</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Optimised Split-Split Plot Design"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-ssplot2" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-ssplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="complex_designs_files/figure-html/fig-ssplot2-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ssplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 2: Final layout of the split-split-plot design showing optimised treatment distribution.
</figcaption></figure>
</div>
</div>
</div>
<p>Above is the final output of this design. Note that there are some adjacent pairs of treatments in the sub-sub-plots. This is quite difficult to avoid in these situations, however adjusting some of the optimisation parameters may help with this. For further information, see the vignette about <a href="./custom_objective_functions.html">changing optimisation parameters for speed</a>.</p>
</section></section></section><section class="section level2"><h2 id="strip-plot-designs">Strip-Plot Designs<a class="anchor" aria-label="anchor" href="#strip-plot-designs"></a>
</h2>
<section class="level2"><h3 id="overview-1">Overview<a class="anchor" aria-label="anchor" href="#overview-1"></a>
</h3>
<p>Strip-plot designs are extensions of split-plot designs used when both treatment factors are difficult to apply to small areas. Treatments are arranged in strips that cross each other, creating a grid pattern where intersections represent treatment combinations.</p>
</section><section class="level2"><h3 id="structure">Structure<a class="anchor" aria-label="anchor" href="#structure"></a>
</h3>
<ul>
<li>
<strong>Horizontal strips</strong> for one factor (e.g., tillage methods)</li>
<li>
<strong>Vertical strips</strong> for another factor (e.g., planting dates)</li>
<li>
<strong>Intersections</strong> represent factor combinations</li>
<li>
<strong>Whole plots</strong> larger than traditional split-plot designs</li>
</ul></section><section class="level2"><h3 id="when-to-use-strip-plot-designs">When to Use Strip-Plot Designs<a class="anchor" aria-label="anchor" href="#when-to-use-strip-plot-designs"></a>
</h3>
<ul>
<li><strong>Both factors require large application areas</strong></li>
<li>
<strong>Machinery constraints</strong> for both factors</li>
<li>
<strong>Irrigation × cultivation</strong> experiments</li>
<li>
<strong>Planting date × row spacing</strong> studies</li>
<li>
<strong>When split-plot hierarchy doesn’t fit</strong> the practical situation</li>
</ul></section><section class="level2"><h3 id="advantages-and-limitations">Advantages and Limitations<a class="anchor" aria-label="anchor" href="#advantages-and-limitations"></a>
</h3>
<section class="level3"><h4 id="advantages">Advantages<a class="anchor" aria-label="anchor" href="#advantages"></a>
</h4>
<ul>
<li><strong>Accommodates two “difficult-to-randomise” factors</strong></li>
<li>
<strong>More flexible</strong> than split-plot for certain applications</li>
<li>
<strong>Maintains reasonable precision</strong> for main effects</li>
<li><strong>Practical for mechanised agriculture</strong></li>
</ul></section><section class="level3"><h4 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h4>
<ul>
<li>
<strong>Lower precision</strong> for interaction effects</li>
<li>
<strong>Complex analysis</strong> with multiple error terms</li>
<li>
<strong>Less efficient</strong> than RCBD for most comparisons</li>
<li><strong>Requires larger field areas</strong></li>
</ul></section></section><section class="level2"><h3 id="example-strip-plot-design-for-tillage-planting-date">Example: Strip-Plot Design for Tillage × Planting Date<a class="anchor" aria-label="anchor" href="#example-strip-plot-design-for-tillage-planting-date"></a>
</h3>
<p>Consider an experiment testing 3 tillage methods and 4 planting dates where both factors require large application areas.</p>
</section><section class="level2"><h3 id="setting-up-strip-plot-designs-with-speed">Setting Up Strip-Plot Designs with speed<a class="anchor" aria-label="anchor" href="#setting-up-strip-plot-designs-with-speed"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_strip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, each <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,  <span class="co"># 12 rows total (4 rows per block x 6 blocks)</span></span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, times <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,  <span class="co"># 6 columns</span></span>
<span>  block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span><span class="op">*</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>,  <span class="co"># 6 blocks, 12 plots each</span></span>
<span>  </span>
<span>  <span class="co"># Horizontal strips (3 levels, applied to rows within each block)</span></span>
<span>  vertical_treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,  <span class="co"># A, B, C</span></span>
<span>  </span>
<span>  <span class="co"># Vertical strips (4 levels, applied to columns within each block)  </span></span>
<span>  horizontal_treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,  <span class="co"># a, b, c, d</span></span>
<span>  </span>
<span>  <span class="co"># Plot identifier within each block</span></span>
<span>  plot_in_block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, times <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-strip-plot1" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-strip-plot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="complex_designs_files/figure-html/fig-strip-plot1-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-strip-plot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 3: Initial layout of the strip plot design showing systematic treatment distribution.
</figcaption></figure>
</div>
</div>
</div>
<p>This shows the initial strip-plot layout with horizontal and vertical strips before optimisation.</p>
<section class="level3"><h4 id="performing-the-optimisation-1">Performing the Optimisation<a class="anchor" aria-label="anchor" href="#performing-the-optimisation-1"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strip_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speed.html">speed</a></span><span class="op">(</span><span class="va">df_strip</span>,</span>
<span>                      swap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ht <span class="op">=</span> <span class="st">"horizontal_treatment"</span>, vt <span class="op">=</span> <span class="st">"vertical_treatment"</span><span class="op">)</span>,</span>
<span>                      swap_within <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ht <span class="op">=</span> <span class="st">"block"</span>, vt <span class="op">=</span> <span class="st">"block"</span><span class="op">)</span>,</span>
<span>                      swap_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>row and col are used as row and column, respectively.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimising level: ht
Level: ht Iteration: 1000 Score: 84 Best: 84 Since Improvement: 875
Level: ht Iteration: 2000 Score: 84 Best: 84 Since Improvement: 1875
Early stopping at iteration 2125 for level ht
Optimising level: vt
Level: vt Iteration: 1000 Score: 54 Best: 54 Since Improvement: 840
Level: vt Iteration: 2000 Score: 54 Best: 54 Since Improvement: 1840
Early stopping at iteration 2160 for level vt </code></pre>
</div>
</div>
</section><section class="level3"><h4 id="output-of-the-optimisation-1">Output of the Optimisation<a class="anchor" aria-label="anchor" href="#output-of-the-optimisation-1"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strip_result</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimised Experimental Design
----------------------------
Score: 138
Iterations Run: 4287
Stopped Early: TRUE TRUE
Treatments:
  ht: a, b, c, d
  vt: A, B, C
Seed: -745752008 </code></pre>
</div>
</div>
</section><section class="level3"><h4 id="visualise-the-output-1">Visualise the Output<a class="anchor" aria-label="anchor" href="#visualise-the-output-1"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">strip_result</span>, treatments <span class="op">=</span> <span class="st">"horizontal_treatment"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Tillage Treatments"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="complex_designs_files/figure-html/strip-plot-plot2-1.png" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">strip_result</span>, treatments <span class="op">=</span> <span class="st">"vertical_treatment"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Planting Date Treatments"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="complex_designs_files/figure-html/strip-plot-plot2-2.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>An optimised strip-plot design with well-arranged treatment combinations!</p>
</section></section></section><section class="section level2"><h2 id="incomplete-block-designs">Incomplete Block Designs<a class="anchor" aria-label="anchor" href="#incomplete-block-designs"></a>
</h2>
<section class="level2"><h3 id="overview-2">Overview<a class="anchor" aria-label="anchor" href="#overview-2"></a>
</h3>
<p>When the number of treatments is large, complete blocks may be impractical due to field size or resource constraints. Incomplete block designs use smaller blocks where not all treatments appear in each block, while still maintaining good statistical properties.</p>
</section><section class="level2"><h3 id="types-of-incomplete-block-designs">Types of Incomplete Block Designs<a class="anchor" aria-label="anchor" href="#types-of-incomplete-block-designs"></a>
</h3>
<section class="level3"><h4 id="balanced-incomplete-block-design-bibd">Balanced Incomplete Block Design (BIBD)<a class="anchor" aria-label="anchor" href="#balanced-incomplete-block-design-bibd"></a>
</h4>
<p>The most restrictive but statistically optimal incomplete block design.</p>
<section class="level4"><h5 id="characteristics">Characteristics:<a class="anchor" aria-label="anchor" href="#characteristics"></a>
</h5>
<ul>
<li>Each treatment appears in exactly <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math> blocks</li>
<li>Each block contains exactly <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> treatments</li>
<li>Each pair of treatments appears together in exactly <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">λ</annotation></semantics></math> blocks</li>
<li>Perfect balance but limited parameter combinations</li>
</ul></section><section class="level4"><h5 id="parameters">Parameters:<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h5>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>v</mi><annotation encoding="application/x-tex">v</annotation></semantics></math> = number of treatments</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math> = number of blocks<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math> = number of blocks containing each treatment</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> = number of treatments per block</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">λ</annotation></semantics></math> = number of blocks containing each pair of treatments</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>k</mi><mo>=</mo><mi>v</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">bk = vr</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">λ(v-1) = r(k-1)</annotation></semantics></math>
</li>
</ul>
<p>What may become apparent from the characteristics and parameters listed above is that these designs are not trivial, and <a href="https://en.wikipedia.org/wiki/Block_design#Pairwise_balanced_uniform_designs_(2-designs_or_BIBDs)" class="external-link">there are specific and limited combinations that will work</a>. In the case of speed, a custom objective function is required to ensure that each pair of treatments appear the same number of times. For an example and further discussion, see the <a href="custom_objective_functions.html">vignette on custom objective functions</a>.</p>
</section></section><section class="level3"><h4 id="resolvable-incomplete-block-design-ribd">Resolvable Incomplete Block Design (RIBD)<a class="anchor" aria-label="anchor" href="#resolvable-incomplete-block-design-ribd"></a>
</h4>
<p>More flexible incomplete block designs where blocks can be grouped into complete replications.</p>
<section class="level4"><h5 id="characteristics-1">Characteristics:<a class="anchor" aria-label="anchor" href="#characteristics-1"></a>
</h5>
<ul>
<li>Blocks can be organised into complete replications</li>
<li>Each replication contains every treatment exactly once</li>
<li>More flexible parameter combinations than BIBD</li>
<li>Excellent for multi-location trials</li>
</ul></section></section><section class="level3"><h4 id="partially-balanced-incomplete-block-design-pbibd">Partially Balanced Incomplete Block Design (PBIBD)<a class="anchor" aria-label="anchor" href="#partially-balanced-incomplete-block-design-pbibd"></a>
</h4>
<p>Relaxes the balance requirements of BIBD while maintaining good statistical properties.</p>
</section></section><section class="level2"><h3 id="when-to-use-incomplete-block-designs">When to Use Incomplete Block Designs<a class="anchor" aria-label="anchor" href="#when-to-use-incomplete-block-designs"></a>
</h3>
<ul>
<li>
<strong>Large number of treatments</strong> (typically &gt;15-20)</li>
<li>
<strong>Limited block size</strong> due to field homogeneity constraints</li>
<li>
<strong>Multi-location variety trials</strong> where shipping costs limit replication</li>
<li>
<strong>Resource limitations</strong> preventing complete replication</li>
<li>
<strong>Preliminary screening</strong> of large treatment sets</li>
</ul></section><section class="level2"><h3 id="example-resolvable-incomplete-block-design-for-6-varieties">Example: Resolvable Incomplete Block Design for 6 Varieties<a class="anchor" aria-label="anchor" href="#example-resolvable-incomplete-block-design-for-6-varieties"></a>
</h3>
<p>Consider a trial with 15 treatments where complete blocks would be too large for field homogeneity. We’ll use an incomplete block design with blocks of size 5.</p>
</section><section class="level2"><h3 id="setting-up-a-resolvable-incomplete-block-design-with-speed">Setting Up a Resolvable Incomplete Block Design with speed<a class="anchor" aria-label="anchor" href="#setting-up-a-resolvable-incomplete-block-design-with-speed"></a>
</h3>
<p>Firstly we need to create a data frame representing the incomplete block design. Here we will use a systematic approach to generate the blocks and treatment combinations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the data frame</span></span>
<span><span class="va">ribd_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span>,                             <span class="co"># Row within each block</span></span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,                      <span class="co"># Column corresponds to block</span></span>
<span>  replicate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,                <span class="co"># 3 replicates, 6 observations each</span></span>
<span>  block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,                    <span class="co"># 6 blocks total, 3 treatments per block</span></span>
<span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"V"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, times <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>   <span class="co"># Treatment assignments</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the design</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ribd_df</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  row col replicate block treatment
1   1   1         1     1        V1
2   2   1         1     1        V2
3   3   1         1     1        V3
4   1   2         1     2        V4
5   2   2         1     2        V5
6   3   2         1     2        V6</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ribdplot1" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-ribdplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="complex_designs_files/figure-html/fig-ribdplot1-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ribdplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 4: Initial layout of the resolvable incomplete block design showing systematic treatment distribution.
</figcaption></figure>
</div>
</div>
</div>
<p><a href="#fig-ribdplot1" class="quarto-xref">Figure 4</a> shows the systematic resolvable incomplete block layout before optimisation. Note that replicates are made of two blocks, in each of which half the treatments will appear, and replicates are made up of pairs of blocks. The treatments can be swapped between blocks, but need to remain within their replicate.</p>
<section class="level3"><h4 id="performing-the-optimisation-2">Performing the Optimisation<a class="anchor" aria-label="anchor" href="#performing-the-optimisation-2"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ribd_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speed.html">speed</a></span><span class="op">(</span><span class="va">ribd_df</span>, </span>
<span>                     swap <span class="op">=</span> <span class="st">"treatment"</span>, </span>
<span>                     swap_within <span class="op">=</span> <span class="st">"replicate"</span>, </span>
<span>                     seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span>    </span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>row and col are used as row and column, respectively.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimising level: single treatment within replicate
Level: single treatment within replicate Iteration: 1000 Score: 1.8 Best: 1.8 Since Improvement: 527
Level: single treatment within replicate Iteration: 2000 Score: 1.8 Best: 1.8 Since Improvement: 1527
Early stopping at iteration 2473 for level single treatment within replicate </code></pre>
</div>
</div>
</section><section class="level3"><h4 id="output-of-the-optimisation-2">Output of the Optimisation<a class="anchor" aria-label="anchor" href="#output-of-the-optimisation-2"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ribd_result</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimised Experimental Design
----------------------------
Score: 1.8
Iterations Run: 2474
Stopped Early: TRUE
Treatments: V1, V2, V3, V4, V5, V6
Seed: 42 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ribd_result</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 8
 $ design_df     :Classes 'design' and 'data.frame':    18 obs. of  5 variables:
  ..$ row      : int [1:18] 1 1 1 1 1 1 2 2 2 2 ...
  ..$ col      : int [1:18] 1 2 3 4 5 6 1 2 3 4 ...
  ..$ replicate: int [1:18] 1 1 2 2 3 3 1 1 2 2 ...
  ..$ block    : int [1:18] 1 2 3 4 5 6 1 2 3 4 ...
  ..$ treatment: chr [1:18] "V3" "V2" "V1" "V4" ...
 $ score         : num 1.8
 $ scores        : num [1:2474] 9 7.4 5.8 6.8 5.4 4.6 4.2 4.2 4.2 4.2 ...
 $ temperatures  : num [1:2474] 100 99 98 97 96.1 ...
 $ iterations_run: num 2474
 $ stopped_early : logi TRUE
 $ treatments    : chr [1:6] "V1" "V2" "V3" "V4" ...
 $ seed          : num 42
 - attr(*, "class")= chr [1:2] "design" "list"</code></pre>
</div>
</div>
</section><section class="level3"><h4 id="visualise-the-output-2">Visualise the Output<a class="anchor" aria-label="anchor" href="#visualise-the-output-2"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">ribd_result</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="complex_designs_files/figure-html/ribd-plot4-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see that each block by itself only contains half the treatments, but when combined, the pairs have a full replicate. The algorithm has also spatially optimised the treatments across rows and columns, giving a nicely optimised resolvable incomplete block design.</p>
</section></section></section><section class="section level2"><h2 id="p-rep-partially-replicated-designs">P-Rep (Partially Replicated) Designs<a class="anchor" aria-label="anchor" href="#p-rep-partially-replicated-designs"></a>
</h2>
<section class="level2"><h3 id="overview-3">Overview<a class="anchor" aria-label="anchor" href="#overview-3"></a>
</h3>
<p>P-rep designs are a modern approach to plant breeding trials where a subset of entries (typically checks and selected test lines) are replicated while the majority of test entries appear only once. This provides a balance between statistical power and resource efficiency.</p>
</section><section class="level2"><h3 id="structure-1">Structure<a class="anchor" aria-label="anchor" href="#structure-1"></a>
</h3>
<ul>
<li>
<strong>Replicated entries</strong>: Key checks and promising lines (typically 20-25% of entries)</li>
<li>
<strong>Unreplicated entries</strong>: Majority of test lines (75-80% of entries)</li>
<li>
<strong>Strategic replication</strong>: Based on breeding program priorities</li>
<li>
<strong>Spatial distribution</strong>: Replicates spread throughout the trial</li>
</ul></section><section class="level2"><h3 id="key-features">Key Features<a class="anchor" aria-label="anchor" href="#key-features"></a>
</h3>
<section class="level3"><h4 id="flexible-replication">Flexible Replication<a class="anchor" aria-label="anchor" href="#flexible-replication"></a>
</h4>
<ul>
<li>
<strong>Variable replication levels</strong> based on entry importance</li>
<li>
<strong>Adaptive strategies</strong> for different breeding stages</li>
<li>
<strong>Resource-efficient</strong> compared to full replication</li>
</ul></section><section class="level3"><h4 id="modern-analysis-methods">Modern Analysis Methods<a class="anchor" aria-label="anchor" href="#modern-analysis-methods"></a>
</h4>
<ul>
<li>
<strong>Mixed models</strong> with spatial correlation</li>
<li>
<strong>BLUP prediction</strong> for unreplicated entries</li>
<li>
<strong>Genomic information</strong> integration possible</li>
<li>
<strong>Spatial adjustment</strong> for field variation</li>
</ul></section></section><section class="level2"><h3 id="when-to-use-p-rep-designs">When to Use P-Rep Designs<a class="anchor" aria-label="anchor" href="#when-to-use-p-rep-designs"></a>
</h3>
<ul>
<li>
<strong>Large-scale breeding trials</strong> (&gt;500 entries)</li>
<li>
<strong>Early generation testing</strong> with limited seed</li>
<li>
<strong>Resource-constrained</strong> breeding programs</li>
<li>
<strong>High-throughput phenotyping</strong> applications</li>
<li><strong>When full replication is impractical</strong></li>
</ul></section><section class="level2"><h3 id="example-p-rep-design-for-large-breeding-trial">Example: P-Rep Design for Large Breeding Trial<a class="anchor" aria-label="anchor" href="#example-p-rep-design-for-large-breeding-trial"></a>
</h3>
<p>Consider a breeding trial with 140 entries where 40 key entries (checks and promising lines) are replicated twice while others appear once. This is a single site design with two blocks.</p>
</section><section class="level2"><h3 id="setting-up-p-rep-designs-with-speed">Setting Up P-Rep Designs with speed<a class="anchor" aria-label="anchor" href="#setting-up-p-rep-designs-with-speed"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prep_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">14</span>, each <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, </span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, times <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>, </span>
<span>  block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="fl">14</span><span class="op">)</span>,</span>
<span>  entry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"V"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">40</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"V"</span>, <span class="fl">41</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="co"># 100 varieties, 40 duplicated</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an indicator for the duplicated entries</span></span>
<span><span class="va">prep_design</span><span class="op">$</span><span class="va">duplicated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">prep_design</span><span class="op">$</span><span class="va">entry</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">prep_design</span><span class="op">$</span><span class="va">entry</span>, fromLast <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">prep_design</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  row col block entry duplicated
1   1   1     1    V1       TRUE
2   1   2     1    V2       TRUE
3   1   3     1    V3       TRUE
4   1   4     1    V4       TRUE
5   1   5     1    V5       TRUE
6   1   6     2    V6       TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-prepplot1" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-prepplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="complex_designs_files/figure-html/fig-prepplot1-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prepplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 5: Initial layout of the p-rep design showing systematic treatment distribution.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-prepplot2" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-prepplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="complex_designs_files/figure-html/fig-prepplot2-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prepplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 6: Initial layout of the p-rep design showing replicated treatments.
</figcaption></figure>
</div>
</div>
</div>
<p>This shows the initial p-rep design with duplicated entries distributed systematically. Once we have set up the data frame, the <code><a href="../reference/speed.html">speed()</a></code> optimisation call is quite straight-forward. Note that we have added <code>block</code> into the <code>spatial_factors</code> argument, to attempt to balance the replicated treatments between blocks as well. Typically with larger designs, we may also want to increase the number of <code>iterations</code> and <code>early_stop_iterations</code> to allow more swapping to take place, however in this case it is not necessary due to the low replication.</p>
<section class="level3"><h4 id="performing-the-optimisation-3">Performing the Optimisation<a class="anchor" aria-label="anchor" href="#performing-the-optimisation-3"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prep_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speed.html">speed</a></span><span class="op">(</span><span class="va">prep_design</span>,</span>
<span>                     swap <span class="op">=</span> <span class="st">"entry"</span>,</span>
<span>                     spatial_factors <span class="op">=</span> <span class="op">~</span> <span class="va">block</span> <span class="op">+</span> <span class="va">row</span> <span class="op">+</span> <span class="va">col</span>, </span>
<span>                     seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>row and col are used as row and column, respectively.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimising level: single entry within whole design
Level: single entry within whole design Iteration: 1000 Score: 2.993939 Best: 2.993939 Since Improvement: 5
Level: single entry within whole design Iteration: 2000 Score: 2.913131 Best: 2.913131 Since Improvement: 818
Level: single entry within whole design Iteration: 3000 Score: 2.913131 Best: 2.913131 Since Improvement: 1818
Early stopping at iteration 3182 for level single entry within whole design </code></pre>
</div>
</div>
</section><section class="level3"><h4 id="output-of-the-optimisation-3">Output of the Optimisation<a class="anchor" aria-label="anchor" href="#output-of-the-optimisation-3"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prep_result</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimised Experimental Design
----------------------------
Score: 2.913131
Iterations Run: 3183
Stopped Early: TRUE
Treatments: V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13, V14, V15, V16, V17, V18, V19, V20, V21, V22, V23, V24, V25, V26, V27, V28, V29, V30, V31, V32, V33, V34, V35, V36, V37, V38, V39, V40, V41, V42, V43, V44, V45, V46, V47, V48, V49, V50, V51, V52, V53, V54, V55, V56, V57, V58, V59, V60, V61, V62, V63, V64, V65, V66, V67, V68, V69, V70, V71, V72, V73, V74, V75, V76, V77, V78, V79, V80, V81, V82, V83, V84, V85, V86, V87, V88, V89, V90, V91, V92, V93, V94, V95, V96, V97, V98, V99, V100
Seed: 42 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">prep_result</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 8
 $ design_df     :Classes 'design' and 'data.frame':    140 obs. of  5 variables:
  ..$ row       : int [1:140] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ col       : int [1:140] 1 2 3 4 5 6 7 8 9 10 ...
  ..$ block     : int [1:140] 1 1 1 1 1 2 2 2 2 2 ...
  ..$ entry     : chr [1:140] "V100" "V16" "V38" "V37" ...
  ..$ duplicated: logi [1:140] TRUE TRUE TRUE TRUE TRUE TRUE ...
 $ score         : num 2.91
 $ scores        : num [1:3183] 4.53 4.49 4.45 4.37 4.37 ...
 $ temperatures  : num [1:3183] 100 99 98 97 96.1 ...
 $ iterations_run: num 3183
 $ stopped_early : logi TRUE
 $ treatments    : chr [1:100] "V1" "V2" "V3" "V4" ...
 $ seed          : num 42
 - attr(*, "class")= chr [1:2] "design" "list"</code></pre>
</div>
</div>
<p>Ideally here we would also like to see an even distribution of the duplicated entries between each block.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prep_result</span><span class="op">$</span><span class="va">design_df</span><span class="op">$</span><span class="va">duplicated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">prep_result</span><span class="op">$</span><span class="va">design_df</span><span class="op">$</span><span class="va">entry</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">prep_result</span><span class="op">$</span><span class="va">design_df</span><span class="op">$</span><span class="va">entry</span>, fromLast <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">prep_result</span><span class="op">$</span><span class="va">design_df</span><span class="op">$</span><span class="va">duplicated</span><span class="op">[</span><span class="va">prep_result</span><span class="op">$</span><span class="va">design_df</span><span class="op">$</span><span class="va">block</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">prep_result</span><span class="op">$</span><span class="va">design_df</span><span class="op">$</span><span class="va">entry</span><span class="op">[</span><span class="va">prep_result</span><span class="op">$</span><span class="va">design_df</span><span class="op">$</span><span class="va">block</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>With 40 duplicated varieties in this block, we know we also have 40 in the other block.</p>
</section><section class="level3"><h4 id="visualise-the-output-3">Visualise the Output<a class="anchor" aria-label="anchor" href="#visualise-the-output-3"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">prep_result</span>, treatments <span class="op">=</span> <span class="st">"entry"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="complex_designs_files/figure-html/prep-design-plot2-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>An optimised p-rep design with strategic replication and spatial distribution. Note that because the treatments column is not called “treatment”, we need to specify the <code>treatments</code> argument in the <code><a href="../reference/autoplot.html">autoplot()</a></code> function.</p>
</section></section></section><section class="section level2"><h2 id="row-column-designs-with-blocking">Row-Column Designs with Blocking<a class="anchor" aria-label="anchor" href="#row-column-designs-with-blocking"></a>
</h2>
<section class="level2"><h3 id="overview-4">Overview<a class="anchor" aria-label="anchor" href="#overview-4"></a>
</h3>
<p>Advanced row-column designs incorporate additional blocking structures to control for multiple sources of variation simultaneously. These designs are particularly useful for large, complex experiments where variation occurs in multiple dimensions.</p>
</section><section class="level2"><h3 id="types-of-row-column-blocking">Types of Row-Column Blocking<a class="anchor" aria-label="anchor" href="#types-of-row-column-blocking"></a>
</h3>
<section class="level3"><h4 id="row-column-designs-with-superblocks">Row-Column Designs with Superblocks<a class="anchor" aria-label="anchor" href="#row-column-designs-with-superblocks"></a>
</h4>
<ul>
<li>
<strong>Superblocks</strong> contain multiple row-column units</li>
<li>
<strong>Hierarchical structure</strong> with blocks within blocks</li>
<li><strong>Multi-level variation control</strong></li>
<li><strong>Suitable for very large experiments</strong></li>
</ul></section><section class="level3"><h4 id="resolvable-row-column-designs">Resolvable Row-Column Designs<a class="anchor" aria-label="anchor" href="#resolvable-row-column-designs"></a>
</h4>
<ul>
<li>
<strong>Complete replications</strong> within the row-column structure</li>
<li><strong>Replications as additional blocking factor</strong></li>
<li><strong>Multiple complete layouts</strong></li>
<li><strong>Good for multi-location or multi-season trials</strong></li>
</ul></section><section class="level3"><h4 id="nested-row-column-designs">Nested Row-Column Designs<a class="anchor" aria-label="anchor" href="#nested-row-column-designs"></a>
</h4>
<ul>
<li><strong>Plots nested within row-column intersections</strong></li>
<li><strong>Sub-sampling within main experimental units</strong></li>
<li><strong>Multiple measurements per treatment combination</strong></li>
<li><strong>Increased precision for specific comparisons</strong></li>
</ul></section></section><section class="level2"><h3 id="applications">Applications<a class="anchor" aria-label="anchor" href="#applications"></a>
</h3>
<ul>
<li>
<strong>Multi-location breeding trials</strong> with spatial control</li>
<li>
<strong>Large greenhouse experiments</strong> with multiple environmental gradients</li>
<li><strong>Field trials with complex spatial patterns</strong></li>
<li>
<strong>High-throughput phenotyping</strong> platforms</li>
</ul></section><section class="level2"><h3 id="example-row-column-design-with-blocking-in-two-dimensions">Example: Row-Column Design with Blocking in Two Dimensions<a class="anchor" aria-label="anchor" href="#example-row-column-design-with-blocking-in-two-dimensions"></a>
</h3>
<p>Consider a large field trial with 40 varieties each replicated 10 times, requiring both row blocks and column blocks.</p>
</section><section class="level2"><h3 id="setting-up-row-column-designs-with-blocking">Setting Up Row-Column Designs with Blocking<a class="anchor" aria-label="anchor" href="#setting-up-row-column-designs-with-blocking"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blocking_2d_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, </span>
<span>                                 col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span>, </span>
<span>                                 treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"V"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">40</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>                                 rowBlock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, each <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>,</span>
<span>                                 colBlock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">blocking_2d_design</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  row col treatment rowBlock colBlock
1   1   1        V1        1        1
2   1   2        V2        1        1
3   1   3        V3        1        2
4   1   4        V4        1        2
5   1   5        V5        1        3
6   1   6        V6        1        3</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-2dblockplot1" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-2dblockplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="complex_designs_files/figure-html/fig-2dblockplot1-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-2dblockplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 7: Initial layout of the 2D blocking design showing systematic treatment distribution.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-2dblockplot2" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-2dblockplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="complex_designs_files/figure-html/fig-2dblockplot2-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-2dblockplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 8: 2D blocking design showing rowBlock layout.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-2dblockplot3" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-2dblockplot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="complex_designs_files/figure-html/fig-2dblockplot3-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-2dblockplot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 9: 2D blocking design showing colBlock layout.
</figcaption></figure>
</div>
</div>
</div>
<p>This shows the initial row-column design with hierarchical blocking structure.</p>
<section class="level3"><h4 id="performing-the-optimisation-4">Performing the Optimisation<a class="anchor" aria-label="anchor" href="#performing-the-optimisation-4"></a>
</h4>
<p>Now we will use the <code><a href="../reference/speed.html">speed()</a></code> function to optimise this design. We will swap treatments within row blocks, while also considering column blocks as a spatial factor. Note that we also set some optimisation parameters to allow for more swaps, as this is a larger design with more treatments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>speed.swap_count <span class="op">=</span> <span class="fl">5</span>, speed.swap_all_blocks <span class="op">=</span> <span class="cn">TRUE</span>, speed.adaptive_swaps <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">blocking_2d_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speed.html">speed</a></span><span class="op">(</span><span class="va">blocking_2d_design</span>, </span>
<span>                            swap <span class="op">=</span> <span class="st">"treatment"</span>, </span>
<span>                            swap_within <span class="op">=</span> <span class="st">"rowBlock"</span>,</span>
<span>                            spatial_factors <span class="op">=</span> <span class="op">~</span> <span class="va">colBlock</span>, </span>
<span>                            iterations <span class="op">=</span> <span class="fl">150000</span>,</span>
<span>                            early_stop_iterations <span class="op">=</span> <span class="fl">50000</span>, </span>
<span>                            seed <span class="op">=</span> <span class="fl">42</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h4 id="output-of-the-optimisation-4">Output of the Optimisation<a class="anchor" aria-label="anchor" href="#output-of-the-optimisation-4"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blocking_2d_result</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimised Experimental Design
----------------------------
Score: 0
Iterations Run: 39972
Stopped Early: TRUE
Treatments: V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13, V14, V15, V16, V17, V18, V19, V20, V21, V22, V23, V24, V25, V26, V27, V28, V29, V30, V31, V32, V33, V34, V35, V36, V37, V38, V39, V40
Seed: 42 </code></pre>
</div>
</div>
</section><section class="level3"><h4 id="visualise-the-output-4">Visualise the Output<a class="anchor" aria-label="anchor" href="#visualise-the-output-4"></a>
</h4>
<div class="cell">
<div class="cell-output-display">
<div id="fig-2dblockplot4" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-2dblockplot4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="complex_designs_files/figure-html/fig-2dblockplot4-1.png" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-2dblockplot4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 10: Final layout of the 2D blocking design showing optimised treatment distribution.
</figcaption></figure>
</div>
</div>
</div>
<p>An optimised row-column design with blocking in two directions.</p>
<!---
# Designs for Irregular Areas

## Overview

Real-world experimental sites often have irregular shapes, obstacles, or varying conditions that prevent the use of standard rectangular designs. Specialised approaches are needed to maintain statistical validity while accommodating practical constraints.

## Types of Irregular Situations

### Irregular Field Shapes

- **Non-rectangular fields** (triangular, circular, L-shaped)
- **Curved boundaries** following natural features
- **Multiple disconnected areas**
- **Terraced or sloped fields**

### Field Obstacles

- **Trees, buildings, or equipment** within the field
- **Wet areas or rocky patches**
- **Access roads or pathways**
- **Utility lines or structures**

### Varying Field Conditions

- **Distinct soil types** within the field
- **Drainage patterns** creating sones
- **Shade gradients** from adjacent features
- **Historical management differences**

## Design Strategies for Irregular Areas

### Adaptive Blocking

- **Blocks follow field contours** or natural boundaries
- **Variable block sizes** to accommodate constraints
- **Flexible shapes** rather than rectangular blocks
- **Natural groupings** of homogeneous areas

### Constraint-Based Optimisation

- **Spatial constraints** for inaccessible areas
- **Adjacency rules** modified for irregular layouts
- **Distance-based optimisation** rather than grid-based
- **Weighted optimisation** for varying quality areas

### Incomplete Coverage Designs

- **Strategic plot placement** in available areas
- **Systematic gaps** where obstacles occur
- **Interpolation methods** for spatial analysis
- **Robust analysis approaches**

## Example: Irregular Field Design with Obstacles

Consider a field trial that must work around existing trees, buildings, and drainage areas, requiring adaptive plot placement.

## Setting Up Designs for Irregular Areas


::: {.cell}

```{.r .cell-code}
# Placeholder: Initialise irregular field design
# # Define field boundaries and obstacles
# field_constraints <- list(
#   boundaries = data.frame(x = c(0, 50, 50, 0), y = c(0, 0, 30, 30)),
#   obstacles = data.frame(x = c(15, 35), y = c(10, 20), radius = c(3, 2))
# )
# irregular_design <- initialise_design_df(entries = 48, reps = 3,
#                                        constraints = field_constraints)
# head(irregular_design)
```
:::



::: {.cell}

:::


This shows the initial design layout accommodating field constraints and obstacles.

### Performing the Optimisation


::: {.cell}

```{.r .cell-code}
# Placeholder: Optimise design with spatial constraints
# irregular_result <- speed(irregular_design,
#                          swap = "entry",
#                          constraints = field_constraints,
#                          seed = 42)
# irregular_result
```
:::


### Output of the Optimisation


::: {.cell}

```{.r .cell-code}
# Placeholder: Show structure of results
# str(irregular_result)
```
:::


### Visualise the Output


::: {.cell}

```{.r .cell-code}
# Placeholder: Final visualisation with constraints
# autoplot(irregular_result) +
#   # Add constraint visualisation
#   geom_polygon(data = field_constraints$obstacles,
#                aes(x = x, y = y), alpha = 0.3, fill = "red")
```
:::


An optimised design that efficiently uses available space while respecting field constraints!
--->
<!---
# Factorial Designs in Incomplete Blocks

## Overview

When factorial experiments involve many treatment combinations, complete replication may be impractical. Factorial designs can be embedded within incomplete block structures to maintain efficiency while reducing experimental size.

## Approaches

### Confounded Factorial Designs

- **Confound** high-order interactions with blocks
- **Sacrifice** information on some interactions
- **Maintain** efficiency for main effects and important interactions

### Fractional Factorial in Blocks

- Use **fractional factorial** structure
- **Block** the reduced treatment set
- **Alias** some effects but maintain key comparisons

## Applications

- **Multi-factor agricultural trials** with resource constraints
- **Industrial experiments** with expensive experimental units
- **Screening experiments** for multiple factors

## Setting Up Factorial Designs in Incomplete Blocks with speed


::: {.cell}

```{.r .cell-code}
# Placeholder for Factorial in Incomplete Blocks example
# This will show:
# - Designing confounded factorial experiments
# - Choosing appropriate confounding schemes
# - Optimising block arrangements with speed
# - Handling fractional factorials in blocks
# - Analysis implications of confounding
# - Efficiency comparisons with complete designs
```
:::


# Nested and Hierarchical Designs

## Overview

Nested designs involve factors that are nested within levels of other factors, creating hierarchical structures. These are common in multi-location trials and breeding programs.

## Structure

### Simple Nesting

- Factor B nested within Factor A
- Different levels of B for each level of A
- Example: Varieties within breeding programs

### Multiple Nesting

- Several factors nested within higher-level factors
- Complex hierarchical relationships
- Example: Plots within blocks within locations

## Applications

- **Multi-location variety trials**
- **Breeding program comparisons**
- **Management system studies**
- **Genotype × environment interactions**

## Setting Up Nested Designs with speed


::: {.cell}

```{.r .cell-code}
# Placeholder for Nested Design example
# This will show:
# - Creating hierarchical factor structures
# - Optimising arrangements within nested constraints
# - Handling multiple levels of nesting
# - Spatial optimisation across hierarchy levels
# - Analysis considerations for nested factors
# - Visualisation of hierarchical structure
```
:::


# Design Selection Guidelines for Complex Designs

## Decision Framework

### Treatment Numbers

- **< 20 treatments**: Consider RCBD or Latin Square
- **20-100 treatments**: Alpha designs often optimal
- **> 100 treatments**: Augmented or incomplete block designs
- **Multiple factors**: Factorial arrangements in blocks

### Resource Constraints

- **Limited field area**: Incomplete blocks or augmented designs
- **High treatment costs**: Augmented designs with fewer checks
- **Labour limitations**: Simpler designs with fewer blocks

### Precision Requirements

- **High precision needed**: Complete designs or highly replicated checks
- **Screening phase**: Augmented designs acceptable
- **Final testing**: Complete replication recommended

## Efficiency Considerations

### Statistical Efficiency

- Compare **A-efficiency**, **D-efficiency**, and **E-efficiency**
- Consider **relative efficiency** to RCBD
- Balance **precision** vs **resource use**

### Practical Efficiency

- **Field layout** feasibility
- **Management** complexity
- **Analysis** requirements
- **Implementation** costs

# Advanced Spatial Optimisation with speed

## Optimisation Strategies for Complex Designs

### Multi-level Optimisation

- **Hierarchical optimisation** for nested structures
- **Constraint handling** for complex design rules
- **Multi-objective** optimisation balancing competing goals

### Custom Objective Functions

- **Weighted combinations** of different criteria
- **Penalty functions** for constraint violations
- **Domain-specific** optimisation goals

## Computational Considerations

### Large Design Challenges

- **Memory management** for large treatment sets
- **Convergence** monitoring and criteria
- **Parallel processing** options
- **Progress tracking** for long optimisations

### Quality Assessment

- **Convergence diagnostics**
- **Multiple optimisation runs**
- **Sensitivity analysis**
- **Robustness testing**

# Best Practices for Complex Designs

## Design Phase

1. **Clearly define objectives** and constraints
2. **Consider practical limitations** early
3. **Compare multiple design options** systematically
4. **Validate design properties** before implementation
5. **Plan for analysis** requirements

## Implementation Phase

1. **Detailed field maps** and plot identification
2. **Quality control** procedures for layout
3. **Backup plans** for implementation issues
4. **Documentation** of actual vs planned layout
5. **Training** for field personnel

## Analysis Phase

1. **Appropriate statistical models** for design structure
2. **Spatial analysis** consideration
3. **Model validation** and diagnostics
4. **Effect interpretation** in context of design
5. **Reporting** design details and limitations
--->
</section></section></section><section class="section level2"><h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Complex experimental designs offer powerful solutions for challenging agricultural research scenarios. The <code>speed</code> package provides essential tools for optimising these designs spatially, ensuring that the statistical advantages of sophisticated designs are fully realised in practice.</p>
<p>Key benefits of using complex designs with spatial optimisation include:</p>
<ul>
<li>
<strong>Efficient resource utilisation</strong> for large-scale studies</li>
<li>
<strong>Maintained statistical rigor</strong> despite practical constraints<br>
</li>
<li>
<strong>Enhanced precision</strong> through appropriate blocking and spatial arrangement</li>
<li>
<strong>Flexible solutions</strong> for diverse research objectives</li>
<li>
<strong>Practical feasibility</strong> through optimised field layouts</li>
</ul>
<p>When selecting and implementing complex designs, researchers should carefully balance statistical efficiency, practical constraints, and research objectives. The spatial optimisation capabilities of <code>speed</code> ensure that these sophisticated designs achieve their full potential in real-world applications.</p>
<!-- For guidance on comparing the efficiency of different design options, see the **"Comparing Experimental Design Efficiency with speed"** vignette. -->
<section class="level2"><h3 id="further-reading">Further Reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h3>
<section class="level3"><h4 id="specialised-design-references">Specialised Design References<a class="anchor" aria-label="anchor" href="#specialised-design-references"></a>
</h4>
<ul>
<li>Cochran, W.G. &amp; Cox, G.M. (1957). <em>Experimental Designs</em>
</li>
<li>John, J.A. &amp; Williams, E.R. (1995). <em>Cyclic and Computer Generated Designs</em><br>
</li>
<li>Bailey, R.A. (2008). <em>Design of Comparative Experiments</em>
</li>
<li>Patterson, H.D. &amp; Williams, E.R. (1976). “A new class of resolvable incomplete block designs”</li>
</ul></section><section class="level3"><h4 id="agricultural-applications">Agricultural Applications<a class="anchor" aria-label="anchor" href="#agricultural-applications"></a>
</h4>
<ul>
<li>Kempton, R.A. &amp; Fox, P.N. (1997). <em>Statistical Methods for Plant Variety Evaluation</em>
</li>
<li>Singh, R. &amp; Chaudhary, B.D. (1985). <em>Biometrical Methods in Quantitative Genetic Analysis</em>
</li>
</ul></section></section><section class="level2"><h3 id="related-vignettes">Related Vignettes<a class="anchor" aria-label="anchor" href="#related-vignettes"></a>
</h3>
<ul>
<li>
<a href="speed.html">Common Agricultural Experimental Designs with speed</a> - Foundational designs for most agricultural applications <!-- - **"Comparing Experimental Design Efficiency with speed"** - Tools for evaluating and comparing design efficiency -->
</li>
</ul>
<hr>
<p><em>This vignette demonstrates advanced applications of the <code>speed</code> package for complex experimental designs. For foundational designs, see the “<a href="speed.html">Common Agricultural Experimental Designs</a>” vignette. For specific implementation details, consult the package documentation and function help files.</em></p>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sam Rogers, Julian Taylor, Russell Edson, Wasin Pipattungsakul, University of Adelaide, Grains Research and Development Corporation.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
