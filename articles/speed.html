<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Common Agricultural Experimental Designs with speed • speed</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="speed_files/libs/quarto-html/popper.min.js"></script><script src="speed_files/libs/quarto-html/tippy.umd.min.js"></script><link href="speed_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="speed_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Common Agricultural Experimental Designs with speed">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">speed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/speed.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/complex_designs.html">Complex Agricultural Experimental Designs with speed</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/biometryhub/speed/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Common Agricultural Experimental Designs with speed</h1>

      <p class="author">Sam Rogers</p>
      <p class="date">2025-08-20</p>

      <small class="dont-index">Source: <a href="https://github.com/biometryhub/speed/blob/main/vignettes/speed.qmd" class="external-link"><code>vignettes/speed.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="section level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Agricultural experiments require careful spatial design to minimise the effects of field heterogeneity and neighbour interactions while maximising statistical power. The <code>speed</code> package provides tools for creating spatially efficient experimental designs through simulated annealing optimisation.</p>
<p>This vignette demonstrates how to use <code>speed</code> for common agricultural experimental designs, showing how spatial optimisation can improve the efficiency and validity of field trials. We’ll work through four key design types, each building in complexity and showing different features of the package.</p>
<p>For advanced and specialised experimental designs (e.g., split-split plot, strip-plot, incomplete block, p-rep, and more), see the companion vignette: <a href="complex_designs.html">Complex Agricultural Experimental Designs with speed</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://biometryhub.github.io/speed/">speed</a></span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="completely-randomised-design-crd">Completely Randomised Design (CRD)<a class="anchor" aria-label="anchor" href="#completely-randomised-design-crd"></a>
</h2>
<section class="level2"><h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>The Completely Randomised Design is the simplest experimental design where treatments are assigned to experimental units entirely at random. While simple to implement, a CRD doesn’t account for spatial variation in field conditions, which can be mitigated by spatial optimisation techniques.</p>
</section><section class="level2"><h3 id="when-to-use">When to Use<a class="anchor" aria-label="anchor" href="#when-to-use"></a>
</h3>
<ul>
<li>Homogeneous experimental conditions</li>
<li>Controlled environments (greenhouse, growth chamber)</li>
<li>Small-scale experiments with minimal spatial variation</li>
<li>Proof-of-concept studies</li>
</ul></section><section class="level2"><h3 id="example-field-trial-with-8-varieties">Example: Field Trial with 8 Varieties<a class="anchor" aria-label="anchor" href="#example-field-trial-with-8-varieties"></a>
</h3>
<p>Consider a field trial testing 8 new wheat varieties with 4 replicates each. Even though treatments are assigned randomly, spatial optimisation can reduce neighbour effects and improve precision.</p>
</section><section class="level2"><h3 id="setting-up-crd-with-speed">Setting Up CRD with speed<a class="anchor" aria-label="anchor" href="#setting-up-crd-with-speed"></a>
</h3>
<p>In agricultural contexts, even completely randomised designs benefit from spatial optimisation to minimise treatment clustering and neighbour effects. Firstly we will initialise a data frame representing the design and visualise it. This design has 4 replicates of 8 treatments or <code>items</code>, with 8 rows and 4 columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialise data frame</span></span>
<span><span class="va">crd_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialise_design_df.html">initialise_design_df</a></span><span class="op">(</span>items <span class="op">=</span> <span class="fl">8</span>, nrows <span class="op">=</span> <span class="fl">8</span>, ncols <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">crd_design</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  row col treatment
1   1   1        T1
2   2   1        T2
3   3   1        T3
4   4   1        T4
5   5   1        T5
6   6   1        T6</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure><p><img src="speed_files/figure-html/crd-plot1-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is a systematic layout; note how the initial layout arranges treatments in a repeating, non-random pattern. This will now be randomised before visualisation.</p>
<section class="level3"><h4 id="performing-the-optimisation">Performing the Optimisation<a class="anchor" aria-label="anchor" href="#performing-the-optimisation"></a>
</h4>
<p>The main <code><a href="../reference/speed.html">speed()</a></code> function performs the optimisation. It has been set up with sensible defaults to allow application to a wide variety of situations. In this case, we only need to provide the design data frame for it to operate on, the column name of the data frame to use for the treatments, and a seed for reproducibility.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crd_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speed.html">speed</a></span><span class="op">(</span><span class="va">crd_design</span>, </span>
<span>                    swap <span class="op">=</span> <span class="st">"treatment"</span>,</span>
<span>                    seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>row and col are used as row and column, respectively.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration: 1000 Score: 2.285714 Best: 2.285714 Since Improvement: 271
Iteration: 2000 Score: 2.285714 Best: 2.285714 Since Improvement: 1271
Early stopping at iteration 2729 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crd_result</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimised Experimental Design
----------------------------
Score: 2.285714
Iterations Run: 2730
Stopped Early: TRUE
Treatments: T1, T2, T3, T4, T5, T6, T7, T8
Seed: 42 </code></pre>
</div>
</div>
</section><section class="level3"><h4 id="output-of-the-optimisation">Output of the Optimisation<a class="anchor" aria-label="anchor" href="#output-of-the-optimisation"></a>
</h4>
<p>The printed output from the returned design object shows the final optimisation score (lower is better), the number of iterations taken to reach that result, if the iterations stopped early due to lack of improvement, the treatments present in the design, and the seed. The output object contains some additional components, which can be seen below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">crd_result</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 8
 $ design_df     :Classes 'design' and 'data.frame':    32 obs. of  3 variables:
  ..$ row      : int [1:32] 1 1 1 1 2 2 2 2 3 3 ...
  ..$ col      : int [1:32] 1 2 3 4 1 2 3 4 1 2 ...
  ..$ treatment: chr [1:32] "T8" "T1" "T7" "T3" ...
 $ score         : num 2.29
 $ scores        : num [1:2730] 40 36.3 32.4 28.3 24.1 ...
 $ temperatures  : num [1:2730] 100 99 98 97 96.1 ...
 $ iterations_run: int 2730
 $ stopped_early : logi TRUE
 $ treatments    : chr [1:8] "T1" "T2" "T3" "T4" ...
 $ seed          : num 42
 - attr(*, "class")= chr [1:2] "design" "list"</code></pre>
</div>
</div>
</section><section class="level3"><h4 id="visualise-the-output">Visualise the Output<a class="anchor" aria-label="anchor" href="#visualise-the-output"></a>
</h4>
<p>The final step is to visualise the optimised design. The plot below displays the spatial arrangement of treatments after optimisation, allowing you to easily check for clustering, spatial trends, or other patterns that may affect your experiment. A well-randomised and spatially efficient design will show treatments distributed evenly across the field, helping to minimise neighbour effects and maximise the reliability of your results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">crd_result</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="speed_files/figure-html/crd-plot2-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A nicely randomised<a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Note that this design is not a true randomised design, as &lt;code&gt;speed&lt;/code&gt; performs restricted randomisation and this design has been optimised to reduce neighbour effects. However, it can still be considered a Completely Randomised Design as it does not account for any blocking or other sources of variation.&lt;/p&gt;"><sup>1</sup></a> and spatially optimal design!</p>
</section></section></section><section class="section level2"><h2 id="randomised-complete-block-design-rcbd">Randomised Complete Block Design (RCBD)<a class="anchor" aria-label="anchor" href="#randomised-complete-block-design-rcbd"></a>
</h2>
<section class="level2"><h3 id="overview-1">Overview<a class="anchor" aria-label="anchor" href="#overview-1"></a>
</h3>
<p>RCBD is one of the most commonly used designs in agricultural research. It controls for one source of variation by grouping experimental units into homogeneous blocks, with each treatment appearing once per block.</p>
</section><section class="level2"><h3 id="when-to-use-1">When to Use<a class="anchor" aria-label="anchor" href="#when-to-use-1"></a>
</h3>
<ul>
<li>Field experiments with known gradient (slope, soil type, irrigation)</li>
<li>Medium to large experiments (3+ treatments)</li>
<li>When blocking factor explains significant variation</li>
<li>Multi-location trials</li>
</ul></section><section class="level2"><h3 id="example-variety-trial-across-field-gradient">Example: Variety Trial Across Field Gradient<a class="anchor" aria-label="anchor" href="#example-variety-trial-across-field-gradient"></a>
</h3>
<p>Consider testing 6 barley varieties across a field with a moisture gradient. Using 4 blocks perpendicular to the gradient helps control for soil moisture variation.</p>
</section><section class="level2"><h3 id="setting-up-rcbd-with-speed">Setting Up RCBD with speed<a class="anchor" aria-label="anchor" href="#setting-up-rcbd-with-speed"></a>
</h3>
<p>Here we initialise a data frame for a design with 4 blocks and 6 treatments, arranged in 4 rows and 6 columns. Note that we can specify treatments in the <code>items</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rcbd_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialise_design_df.html">initialise_design_df</a></span><span class="op">(</span>items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"V"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, nrows <span class="op">=</span> <span class="fl">4</span>, ncols <span class="op">=</span> <span class="fl">6</span>, block_nrows <span class="op">=</span> <span class="fl">1</span>, block_ncols <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rcbd_design</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  row col treatment row_block col_block block
1   1   1        V1         1         1     1
2   2   1        V2         2         1     2
3   3   1        V3         3         1     3
4   4   1        V4         4         1     4
5   1   2        V5         1         1     1
6   2   2        V6         2         1     2</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure><p><img src="speed_files/figure-html/rcbd-plot1-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is a systematic block layout; each block contains all treatments in a repeating pattern. This will now be randomised within blocks.</p>
<section class="level3"><h4 id="performing-the-optimisation-1">Performing the Optimisation<a class="anchor" aria-label="anchor" href="#performing-the-optimisation-1"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rcbd_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speed.html">speed</a></span><span class="op">(</span><span class="va">rcbd_design</span>, </span>
<span>                     swap <span class="op">=</span> <span class="st">"treatment"</span>,</span>
<span>                     swap_within <span class="op">=</span> <span class="st">"block"</span>,</span>
<span>                     seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>row and col are used as row and column, respectively.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration: 1000 Score: 1.6 Best: 1.6 Since Improvement: 672
Iteration: 2000 Score: 1.6 Best: 1.6 Since Improvement: 1672
Early stopping at iteration 2328 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rcbd_result</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimised Experimental Design
----------------------------
Score: 1.6
Iterations Run: 2329
Stopped Early: TRUE
Treatments: V1, V2, V3, V4, V5, V6
Seed: 42 </code></pre>
</div>
</div>
</section><section class="level3"><h4 id="output-of-the-optimisation-1">Output of the Optimisation<a class="anchor" aria-label="anchor" href="#output-of-the-optimisation-1"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">rcbd_result</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 8
 $ design_df     :Classes 'design' and 'data.frame':    24 obs. of  6 variables:
  ..$ row      : int [1:24] 1 1 1 1 1 1 2 2 2 2 ...
  ..$ col      : int [1:24] 1 2 3 4 5 6 1 2 3 4 ...
  ..$ treatment: chr [1:24] "V4" "V1" "V5" "V6" ...
  ..$ row_block: int [1:24] 1 1 1 1 1 1 2 2 2 2 ...
  ..$ col_block: int [1:24] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ block    : num [1:24] 1 1 1 1 1 1 2 2 2 2 ...
 $ score         : num 1.6
 $ scores        : num [1:2329] 34 29.6 25.2 21.6 18.4 16.2 13 12.2 8.6 10.4 ...
 $ temperatures  : num [1:2329] 100 99 98 97 96.1 ...
 $ iterations_run: int 2329
 $ stopped_early : logi TRUE
 $ treatments    : chr [1:6] "V1" "V2" "V3" "V4" ...
 $ seed          : num 42
 - attr(*, "class")= chr [1:2] "design" "list"</code></pre>
</div>
</div>
</section><section class="level3"><h4 id="visualise-the-output-1">Visualise the Output<a class="anchor" aria-label="anchor" href="#visualise-the-output-1"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">rcbd_result</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="speed_files/figure-html/rcbd-plot2-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A well-randomised and spatially efficient RCBD layout.</p>
</section></section></section><section class="section level2"><h2 id="latin-square-design">Latin Square Design<a class="anchor" aria-label="anchor" href="#latin-square-design"></a>
</h2>
<section class="level2"><h3 id="overview-2">Overview<a class="anchor" aria-label="anchor" href="#overview-2"></a>
</h3>
<p>Latin Square Design controls for two sources of variation simultaneously by arranging treatments in a square grid where each treatment appears exactly once in each row and column.</p>
</section><section class="level2"><h3 id="when-to-use-2">When to Use<a class="anchor" aria-label="anchor" href="#when-to-use-2"></a>
</h3>
<ul>
<li>Small to medium experiments (3-10 treatments)</li>
<li>Two known sources of variation (e.g., row and column effects)</li>
<li>Greenhouse bench experiments</li>
<li>Field experiments with two-way gradients</li>
</ul></section><section class="level2"><h3 id="constraints">Constraints<a class="anchor" aria-label="anchor" href="#constraints"></a>
</h3>
<ul>
<li>Number of treatments must equal number of rows and columns</li>
<li>Limited degrees of freedom for error</li>
<li>Assumes no row × column interaction</li>
</ul></section><section class="level2"><h3 id="setting-up-latin-square-with-speed">Setting Up Latin Square with speed<a class="anchor" aria-label="anchor" href="#setting-up-latin-square-with-speed"></a>
</h3>
<p>Here we initialise a 5 × 5 Latin square with 5 treatments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latin_square_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialise_design_df.html">initialise_design_df</a></span><span class="op">(</span>items <span class="op">=</span> <span class="fl">5</span>, nrows <span class="op">=</span> <span class="fl">5</span>, ncols <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">latin_square_design</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  row col treatment
1   1   1        T1
2   2   1        T2
3   3   1        T3
4   4   1        T4
5   5   1        T5
6   1   2        T1</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure><p><img src="speed_files/figure-html/latin-square-plot1-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is a systematic Latin square layout; each treatment appears once per row and column. The design will now be randomised.</p>
<section class="level3"><h4 id="performing-the-optimisation-2">Performing the Optimisation<a class="anchor" aria-label="anchor" href="#performing-the-optimisation-2"></a>
</h4>
<p>Because of the spatial optimisation algorithm built into <code>speed</code>, with default options and enough iterations, it should arrive at a Latin square design in cases where the number of rows, columns, treatments and replicates are all equal such as this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latin_square_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speed.html">speed</a></span><span class="op">(</span><span class="va">latin_square_design</span>, </span>
<span>                             swap <span class="op">=</span> <span class="st">"treatment"</span>,</span>
<span>                             seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>row and col are used as row and column, respectively.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration: 1000 Score: 1 Best: 1 Since Improvement: 308
Early stopping at iteration 1040 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latin_square_result</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimised Experimental Design
----------------------------
Score: 0
Iterations Run: 1041
Stopped Early: TRUE
Treatments: T1, T2, T3, T4, T5
Seed: 42 </code></pre>
</div>
</div>
</section><section class="level3"><h4 id="output-of-the-optimisation-2">Output of the Optimisation<a class="anchor" aria-label="anchor" href="#output-of-the-optimisation-2"></a>
</h4>
<p>Note that the final score of zero shows that the algorithm has found a perfect Latin Square solution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">latin_square_result</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 8
 $ design_df     :Classes 'design' and 'data.frame':    25 obs. of  3 variables:
  ..$ row      : int [1:25] 1 1 1 1 1 2 2 2 2 2 ...
  ..$ col      : int [1:25] 1 2 3 4 5 1 2 3 4 5 ...
  ..$ treatment: chr [1:25] "T3" "T2" "T5" "T1" ...
 $ score         : num 0
 $ scores        : num [1:1041] 45 39 37 33.5 30.5 32.5 32 30.5 26.5 29 ...
 $ temperatures  : num [1:1041] 100 99 98 97 96.1 ...
 $ iterations_run: int 1041
 $ stopped_early : logi TRUE
 $ treatments    : chr [1:5] "T1" "T2" "T3" "T4" ...
 $ seed          : num 42
 - attr(*, "class")= chr [1:2] "design" "list"</code></pre>
</div>
</div>
</section><section class="level3"><h4 id="visualise-the-output-2">Visualise the Output<a class="anchor" aria-label="anchor" href="#visualise-the-output-2"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">latin_square_result</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="speed_files/figure-html/latin-square-plot2-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A well-randomised and spatially efficient Latin square layout.</p>
</section></section></section><section class="section level2"><h2 id="split-plot-design">Split-Plot Design<a class="anchor" aria-label="anchor" href="#split-plot-design"></a>
</h2>
<section class="level2"><h3 id="overview-3">Overview<a class="anchor" aria-label="anchor" href="#overview-3"></a>
</h3>
<p>Split-Plot Design is used when some treatments are easier to apply to large areas (whole plots) while others require smaller areas (sub-plots). This creates a hierarchical structure with different levels of precision. Split-Plot Designs are particularly useful in agricultural experiments where some factors are difficult or expensive to replicate at the whole plot level. These designs are possible with the <code>speed</code> package, allowing for spatial optimisation of both whole plots and sub-plots in a single step.</p>
</section><section class="level2"><h3 id="when-to-use-3">When to Use<a class="anchor" aria-label="anchor" href="#when-to-use-3"></a>
</h3>
<ul>
<li>Treatments with different application scales (large vs small plots)</li>
<li>Irrigation × variety experiments</li>
<li>Tillage × fertiliser studies</li>
<li>When some treatments are expensive or difficult to replicate</li>
</ul></section><section class="level2"><h3 id="structure">Structure<a class="anchor" aria-label="anchor" href="#structure"></a>
</h3>
<ul>
<li>
<strong>Whole plots</strong>: Larger experimental units (main treatments)</li>
<li>
<strong>Sub-plots</strong>: Smaller units within whole plots (sub-treatments)</li>
<li>Different error terms for different treatment levels</li>
</ul></section><section class="level2"><h3 id="setting-up-split-plot-design-with-speed">Setting Up Split Plot Design with speed<a class="anchor" aria-label="anchor" href="#setting-up-split-plot-design-with-speed"></a>
</h3>
<p>Now we can create a data frame representing a split plot design. Note that the <code>initalise_design_df</code> function does not currently support split plot designs directly, so we will create it manually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">split_plot_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, times <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, each <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    wholeplot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    wholeplot_treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    subplot_treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">12</span><span class="op">)</span></span>
<span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">split_plot_design</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  row col block wholeplot wholeplot_treatment subplot_treatment
1   1   1     1         1                   A                 a
2   1   2     1         1                   A                 b
3   1   3     1         1                   A                 c
4   1   4     1         1                   A                 d
5   2   1     1         2                   B                 a
6   2   2     1         2                   B                 b</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure><p><img src="speed_files/figure-html/split-plot-plot1-1.png" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure><p><img src="speed_files/figure-html/split-plot-plot1-2.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is a systematic split plot layout; each treatment appears once per block for whole plot treatments, and once per whole plot for sub-plot treatments. The design will now be randomised.</p>
<section class="level3"><h4 id="performing-the-optimisation-3">Performing the Optimisation<a class="anchor" aria-label="anchor" href="#performing-the-optimisation-3"></a>
</h4>
<p>For split-plot designs, we use named lists to specify the hierarchical structure. The <code>swap</code> parameter defines what to optimise at each level, while <code>swap_within</code> defines the constraints for each level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">split_plot_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speed.html">speed</a></span><span class="op">(</span><span class="va">split_plot_design</span>,</span>
<span>                           swap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wp <span class="op">=</span> <span class="st">"wholeplot_treatment"</span>,</span>
<span>                                       sp <span class="op">=</span> <span class="st">"subplot_treatment"</span><span class="op">)</span>,</span>
<span>                           swap_within <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wp <span class="op">=</span> <span class="st">"block"</span>, sp <span class="op">=</span> <span class="st">"wholeplot"</span><span class="op">)</span>,</span>
<span>                           seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>row and col are used as row and column, respectively.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimising level: wp
Level: wp Iteration: 1000 Score: 100 Best: 100 Since Improvement: 1000
Level: wp Iteration: 2000 Score: 100 Best: 100 Since Improvement: 2000
Early stopping at iteration 2000 for level wp
Optimising level: sp
Early stopping at iteration 570 for level sp </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">split_plot_result</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimised Experimental Design
----------------------------
Score: 100
Iterations Run: 2572
Stopped Early: TRUE TRUE
Treatments:
  wp: A, B, C
  sp: a, b, c, d
Seed: 42 </code></pre>
</div>
</div>
</section><section class="level3"><h4 id="output-of-the-optimisation-3">Output of the Optimisation<a class="anchor" aria-label="anchor" href="#output-of-the-optimisation-3"></a>
</h4>
<p>The output shows optimisation results for the design. The score and iterations are combined for the entire design, while the treatments, and stopping criteria are reported separately for each level, allowing you to assess the quality of optimisation at each hierarchy level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">split_plot_result</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 8
 $ design_df     :Classes 'design' and 'data.frame':    48 obs. of  6 variables:
  ..$ row                : int [1:48] 1 1 1 1 2 2 2 2 3 3 ...
  ..$ col                : int [1:48] 1 2 3 4 1 2 3 4 1 2 ...
  ..$ block              : int [1:48] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ wholeplot          : int [1:48] 1 1 1 1 2 2 2 2 3 3 ...
  ..$ wholeplot_treatment: chr [1:48] "C" "C" "C" "C" ...
  ..$ subplot_treatment  : chr [1:48] "a" "b" "c" "d" ...
 $ score         : num 100
 $ scores        :List of 2
  ..$ wp: num [1:2001] 100 104 104 104 104 104 104 104 100 100 ...
  ..$ sp: num [1:571] 188 169 151 133 125 ...
 $ temperatures  :List of 2
  ..$ wp: num [1:2001] 100 99 98 97 96.1 ...
  ..$ sp: num [1:571] 100 99 98 97 96.1 ...
 $ iterations_run: num 2572
 $ stopped_early : Named logi [1:2] TRUE TRUE
  ..- attr(*, "names")= chr [1:2] "wp" "sp"
 $ treatments    :List of 2
  ..$ wp: chr [1:3] "A" "B" "C"
  ..$ sp: chr [1:4] "a" "b" "c" "d"
 $ seed          : num 42
 - attr(*, "class")= chr [1:2] "design" "list"</code></pre>
</div>
</div>
</section><section class="level3"><h4 id="visualise-the-output-3">Visualise the Output<a class="anchor" aria-label="anchor" href="#visualise-the-output-3"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">split_plot_result</span>, treatments <span class="op">=</span> <span class="st">"wholeplot_treatment"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="speed_files/figure-html/split-plot-plot2-1.png" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">split_plot_result</span>, treatments <span class="op">=</span> <span class="st">"subplot_treatment"</span>, block <span class="op">=</span> <span class="st">"wholeplot"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="speed_files/figure-html/split-plot-plot2-2.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This design has now been optimised at both the whole plot level and the sub-plot level.</p>
</section></section></section><section class="section level2"><h2 id="spatial-design-considerations">Spatial Design Considerations<a class="anchor" aria-label="anchor" href="#spatial-design-considerations"></a>
</h2>
<section class="level2"><h3 id="field-shape-and-orientation">Field Shape and Orientation<a class="anchor" aria-label="anchor" href="#field-shape-and-orientation"></a>
</h3>
<p>The shape and orientation of your experimental field significantly impacts design efficiency:</p>
<ul>
<li>
<strong>Long, narrow fields</strong>: Favour designs with blocks perpendicular to the long axis</li>
<li>
<strong>Square fields</strong>: Allow more flexibility in blocking direction</li>
<li>
<strong>Irregular shapes</strong>: May require custom design approaches</li>
</ul></section><section class="level2"><h3 id="neighbour-effects">Neighbour Effects<a class="anchor" aria-label="anchor" href="#neighbour-effects"></a>
</h3>
<p>Agricultural experiments often experience neighbour effects where adjacent plots influence each other:</p>
<ul>
<li>
<strong>Competition effects</strong>: Tall varieties shading short ones</li>
<li>
<strong>Contamination</strong>: Fertiliser or pesticide drift</li>
<li>
<strong>Root competition</strong>: Nutrient or water competition between plots</li>
</ul>
<p>The <code>speed</code> package specifically addresses these issues through spatial optimisation.</p>
</section><section class="level2"><h3 id="buffer-areas">Buffer Areas<a class="anchor" aria-label="anchor" href="#buffer-areas"></a>
</h3>
<p>Consider including buffer areas or border plots to:</p>
<ul>
<li>Reduce edge effects</li>
<li>minimise contamination between treatments</li>
<li>Provide realistic growing conditions</li>
</ul></section></section><section class="section level2"><h2 id="using-speed-effectively">Using <code>speed</code> Effectively<a class="anchor" aria-label="anchor" href="#using-speed-effectively"></a>
</h2>
<ol type="1">
<li>
<strong>Set appropriate parameters</strong>: Balance optimisation time with improvement <!-- Link to vignette on parameters -->
</li>
<li>
<strong><a href="autoplot.html">Visualise designs</a></strong>: Always plot layouts before implementation <!-- Link to autoplot -->
</li>
<li>
<strong>Compare alternatives</strong>: Test multiple blocking strategies</li>
<li>
<strong>Validate results</strong>: Check constraint satisfaction and efficiency metrics</li>
</ol></section><section class="section level2"><h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The <code>speed</code> package provides powerful tools for creating spatially efficient experimental designs. By optimising treatment arrangements, researchers can:</p>
<ul>
<li>Reduce neighbour effects and spatial confounding</li>
<li>Improve statistical power and precision</li>
<li>Maintain design validity and balance</li>
<li>Visualise and evaluate design quality</li>
</ul>
<p>Whether using simple randomised designs or complex split-plot structures, spatial optimisation through <code>speed</code> can significantly enhance the efficiency and reliability of agricultural experiments.</p>
<section class="level2"><h3 id="further-reading">Further Reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h3>
<ul>
<li>Montgomery, D.C. (2017). <em>Design and Analysis of Experiments</em>
</li>
<li>Mead, R. (1988). <em>The Design of Experiments</em>
</li>
<li>John, J.A. &amp; Williams, E.R. (1995). <em>Cyclic and Computer Generated Designs</em>
</li>
<li>Bailey, R.A. (2008). <em>Design of Comparative Experiments</em>
</li>
</ul>
<p><em>This vignette demonstrates the versatility of the <code>speed</code> package for agricultural experimental design. For more advanced applications and custom designs, consult the package documentation and additional vignettes.</em></p>
</section></section><section class="section level2"><h2 id="related-vignettes">Related Vignettes<a class="anchor" aria-label="anchor" href="#related-vignettes"></a>
</h2>
<ul>
<li>
<a href="complex_designs.html">Complex Agricultural Experimental Designs with speed</a>: Advanced and specialised designs, including split-split plot, strip-plot, incomplete block, p-rep, and more.</li>
</ul></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sam Rogers, Julian Taylor, Russell Edson, Wasin Pipattungsakul, University of Adelaide, Grains Research and Development Corporation.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
